{
  "task_id": "APPS/223",
  "problem_id": 223,
  "prompt": "Let's define a function $f(p)$ on a permutation $p$ as follows. Let $g_i$ be the greatest common divisor (GCD) of elements $p_1$, $p_2$, ..., $p_i$ (in other words, it is the GCD of the prefix of length $i$). Then $f(p)$ is the number of distinct elements among $g_1$, $g_2$, ..., $g_n$.\n\nLet $f_{max}(n)$ be the maximum value of $f(p)$ among all permutations $p$ of integers $1$, $2$, ..., $n$.\n\nGiven an integers $n$, count the number of permutations $p$ of integers $1$, $2$, ..., $n$, such that $f(p)$ is equal to $f_{max}(n)$. Since the answer may be large, print the remainder of its division by $1000\\,000\\,007 = 10^9 + 7$.\n\n\n-----Input-----\n\nThe only line contains the integer $n$ ($2 \\le n \\le 10^6$)\u00a0\u2014 the length of the permutations.\n\n\n-----Output-----\n\nThe only line should contain your answer modulo $10^9+7$.\n\n\n-----Examples-----\nInput\n2\n\nOutput\n1\nInput\n3\n\nOutput\n4\nInput\n6\n\nOutput\n120\n\n\n-----Note-----\n\nConsider the second example: these are the permutations of length $3$:  $[1,2,3]$, $f(p)=1$.  $[1,3,2]$, $f(p)=1$.  $[2,1,3]$, $f(p)=2$.  $[2,3,1]$, $f(p)=2$.  $[3,1,2]$, $f(p)=2$.  $[3,2,1]$, $f(p)=2$. \n\nThe maximum value $f_{max}(3) = 2$, and there are $4$ permutations $p$ such that $f(p)=2$.",
  "solutions": "[\"p=10**9+7\\nimport math\\ndef inv(k,p):\\n    prod=1\\n    while k>1:\\n        prod*=(p//k+1)\\n        k=(k*(p//k+1))%p\\n    return prod%p\\nn=int(input())\\na=[]\\nk=int(math.log2(n))\\nx=n\\nwhile x>0:\\n    y=x//2\\n    a.append(x-y)\\n    x=y\\nc=[sum(a[i:]) for i in range(k+1)]\\nb=[n//(3*2**i)-n//(6*2**i) for i in range(k+1)]\\nd=[n//2**i-n//(3*2**i) for i in range(k+1)]\\nfacs=[1]*(n+1)\\nfor i in range(2,n+1):\\n    facs[i]=(i*facs[i-1])%p\\nif n<3*(2**(k-1)):\\n    start=k\\nelse:\\n    start=0\\ntot=0\\nfor j in range(start,k+1):\\n    prod=1\\n    for i in range(j,k):\\n        prod*=b[i]\\n    prod*=d[j]\\n    for i in range(j):\\n        prod*=a[i]\\n    prod%=p\\n    prod*=facs[n]\\n    e=[a[i] for i in range(j)]+[d[j]]+[b[i] for i in range(j,k)]\\n    f=[sum(e[:i+1]) for i in range(k+1)]\\n    g=1\\n    for guy in f:\\n        g*=guy\\n    prod*=inv(g,p)\\n    prod%=p\\n    tot+=prod\\nprint(tot%p)\", \"p=10**9+7\\nimport math\\ndef prod(l):\\n    x=1\\n    for m in l:\\n        x*=m\\n    return x\\nn=int(input())\\na=[]\\nk=int(math.log2(n))\\nx=n\\nwhile x>0:\\n    y=x//2\\n    a.append(x-y)\\n    x=y\\nc=[sum(a[i:]) for i in range(k+1)]\\nb=[n//(3*2**i)-n//(6*2**i) for i in range(k+1)]\\nd=[n//2**i-n//(3*2**i) for i in range(k+1)]\\nfacs=[1]*(n+1)\\nfor i in range(2,n+1):\\n    facs[i]=(i*facs[i-1])%p\\nstart=k if n<3*(2**(k-1)) else 0\\ntot=0\\nfor j in range(start,k+1):\\n    e=[a[i] for i in range(j)]+[d[j]]+[b[i] for i in range(j,k)]\\n    x=(facs[n]*prod(e))%p\\n    f=prod([sum(e[:i+1]) for i in range(k+1)])\\n    while f>1:\\n        x*=p//f+1\\n        f=(f*(p//f+1))%p\\n    tot+=x%p\\nprint(tot%p)\", \"p=10**9+7\\nimport math\\ndef prod(l):\\n    x=1\\n    for m in l:\\n        x=x*m%p\\n    return x\\nn=int(input())\\na,k,x,t=[],int(math.log2(n)),n,0\\nwhile x>0:\\n    a.append(x-x//2)\\n    x//=2\\nc=[sum(a[i:]) for i in range(k+1)]\\nb=[n//(3*2**i)-n//(6*2**i) for i in range(k+1)]\\nd=[n//2**i-n//(3*2**i) for i in range(k+1)]\\ny=prod([i for i in range(2,n+1)])\\ns=k if n<3*(2**(k-1)) else 0\\nfor j in range(s,k+1):\\n    e=[a[i] for i in range(j)]+[d[j]]+[b[i] for i in range(j,k)]\\n    x=(y*prod(e))%p\\n    f=prod([sum(e[:i+1]) for i in range(k+1)])\\n    while f>1:\\n        x*=p//f+1\\n        f=(f*(p//f+1))%p\\n    t+=x%p\\nprint(t%p)\", \"p=10**9+7\\nimport math\\ndef r(l):\\n    x=1\\n    for m in l:\\n        x=x*m%p\\n    return x\\nn=int(input())\\na,k,x,t=[],int(math.log2(n)),n,0\\nwhile x>0:\\n    a.append(x-x//2)\\n    x//=2\\nb=[n//(3*2**i)-n//(6*2**i) for i in range(k+1)]\\nd=[n//2**i-n//(3*2**i) for i in range(k+1)]\\ny=r([i for i in range(2,n+1)])\\ns=k if n<3*2**(k-1) else 0\\nfor j in range(s,k+1):\\n    e=[a[i] for i in range(j)]+[d[j]]+[b[i] for i in range(j,k)]\\n    x=y*r(e)%p\\n    f=r([sum(e[:i+1]) for i in range(k+1)])\\n    while f>1:\\n        x*=p//f+1\\n        f=f*(p//f+1)%p\\n    t+=x%p\\nprint(t%p)\", \"p=10**9+7\\nimport math\\ndef r(l):\\n    x=1\\n    for m in l:\\n        x=x*m%p\\n    return x\\nn=int(input())\\na,k,x,t=[],int(math.log2(n)),n,0\\nwhile x>0:\\n    a.append(x-x//2)\\n    x//=2\\nb=[n//(3*2**i)-n//(6*2**i) for i in range(k+1)]\\nd=[n//2**i-n//(3*2**i) for i in range(k+1)]\\ny=r(i for i in range(2,n+1))\\ns=k if n<3*2**(k-1) else 0\\nfor j in range(s,k+1):\\n    e=[a[i] for i in range(j)]+[d[j]]+[b[i] for i in range(j,k)]\\n    x=y*r(e)%p\\n    f=r(sum(e[:i+1]) for i in range(k+1))\\n    while f>1:\\n        x*=p//f+1\\n        f=f*(p//f+1)%p\\n    t+=x%p\\nprint(t%p)\", \"def binpow(x, t, mod):\\n    if t == 0:\\n        return 1\\n    if t % 2 == 0:\\n        return binpow(x * x % mod, t//2, mod)\\n    return binpow(x, t-1, mod) * x % mod\\n\\ndef calc(a, f, rv, n):\\n    mod = 10 ** 9 + 7\\n    s = 0\\n    ans = 1\\n    for i in range(len(a)-1, -1, -1):\\n        cur = n//a[i]\\n        if i > 0:\\n            cur -= n//a[i-1]\\n        t = cur-1\\n        s += t\\n        ans = ans * cur * f[s] * rv[s-t] % mod\\n        #print(a[i], cur, s, f[s], rv[s-t])\\n        s += 1\\n    return ans\\nn = int(input())\\nx = n\\nc = 0\\nwhile x > 1:\\n    x //= 2\\n    c+=1\\nf = [1] * 1000100\\nmod = 10**9 + 7\\nfor i in range(1, len(f)):\\n    f[i] = f[i-1] * i % mod\\nrv = [1] * 1000100\\nrv[-1] = binpow(f[-1], mod-2, mod)\\nfor i in range(len(f)-2, 0, -1):\\n    rv[i] = rv[i+1] * (i+1) % mod\\na = []\\nfor i in range(c, -1, -1):\\n    a.append(2**i)\\nans=calc(a, f, rv, n)\\nif (2**(c-1)) * 3 <= n:\\n    c -= 1\\n    a = []\\n    while c >= 0:\\n        a.append((2**c) * 3)\\n        b = a.copy()\\n        for i in range(c, -1, -1):\\n            b.append(2**i)\\n        ans = (ans + calc(b, f, rv, n)) % mod\\n        c -= 1\\nprint(ans)\", \"def perm(a,b):\\n    ret = 1\\n    for i in range(a, a - b, -1):\\n        ret = (ret * i)%1000000007\\n    return ret\\n\\nnum = int(input())\\nnum2 = num\\nc = 0\\nwhile num2:\\n    c += 1\\n    num2 >>= 1\\npow2 = 1 << (c-1)\\narray = [pow2]\\nfor i in range(c-1):\\n    array.append(array[-1]>>1)\\n\\ndef calc(arr):\\n    data = []\\n    #sm = 0\\n    av = num\\n    for i in range(c):\\n        data.append((num // arr[i] - (num - av), av))\\n        av -= data[-1][0]\\n\\n\\n    #print(data)\\n\\n    ans = 1\\n    for d in data:\\n        ans = (ans * (d[0] * perm(d[1] - 1, d[0] - 1)))%1000000007\\n    return ans\\n\\nanswer = calc(array)\\n\\nif num >= pow2 // 2 * 3:\\n    for i in range(1,c):\\n        dat = [1]\\n        for j in range(1, c):\\n            if j == i:\\n                dat = [3*dat[0]] + dat\\n            else:\\n                dat = [2*dat[0]] + dat\\n        #print(dat)\\n        a = calc(dat)\\n        answer += a\\n\\nprint(answer%1000000007)\\n\\n\"]",
  "input_output": "{\n  \"inputs\": [\n    \"2\\n\",\n    \"3\\n\",\n    \"6\\n\",\n    \"10\\n\",\n    \"64\\n\",\n    \"1227\\n\",\n    \"49152\\n\",\n    \"1000000\\n\",\n    \"524288\\n\",\n    \"786431\\n\",\n    \"999999\\n\",\n    \"217292\\n\",\n    \"16339\\n\",\n    \"4\\n\",\n    \"5\\n\",\n    \"7\\n\",\n    \"8\\n\",\n    \"9\\n\",\n    \"50\\n\",\n    \"87\\n\",\n    \"71\\n\",\n    \"73\\n\",\n    \"89\\n\",\n    \"40\\n\",\n    \"42\\n\",\n    \"847\\n\",\n    \"676\\n\",\n    \"639\\n\",\n    \"957\\n\",\n    \"156\\n\",\n    \"479\\n\",\n    \"586\\n\",\n    \"683\\n\",\n    \"3541\\n\",\n    \"6264\\n\",\n    \"4140\\n\",\n    \"8969\\n\",\n    \"3080\\n\",\n    \"7127\\n\",\n    \"3116\\n\",\n    \"86214\\n\",\n    \"28211\\n\",\n    \"62544\\n\",\n    \"96262\\n\",\n    \"21504\\n\",\n    \"603070\\n\",\n    \"261873\\n\",\n    \"582911\\n\",\n    \"789700\\n\",\n    \"838757\\n\",\n    \"546330\\n\",\n    \"774942\\n\",\n    \"629462\\n\",\n    \"131156\\n\",\n    \"874465\\n\",\n    \"200945\\n\",\n    \"919645\\n\",\n    \"215283\\n\",\n    \"955654\\n\",\n    \"437675\\n\",\n    \"175863\\n\",\n    \"126395\\n\",\n    \"406138\\n\",\n    \"425221\\n\",\n    \"460829\\n\",\n    \"211425\\n\",\n    \"662327\\n\",\n    \"798412\\n\",\n    \"163259\\n\",\n    \"786432\\n\"\n  ],\n  \"outputs\": [\n    \"1\",\n    \"4\",\n    \"120\",\n    \"15120\",\n    \"676169815\",\n    \"9412302\",\n    \"468540828\",\n    \"943169120\",\n    \"948408574\",\n    \"973886300\",\n    \"88378773\",\n    \"936105571\",\n    \"166382218\",\n    \"2\",\n    \"6\",\n    \"600\",\n    \"240\",\n    \"1440\",\n    \"938830187\",\n    \"247668980\",\n    \"744016814\",\n    \"405863164\",\n    \"222320695\",\n    \"193507326\",\n    \"270627256\",\n    \"206774372\",\n    \"491267527\",\n    \"32577133\",\n    \"885557037\",\n    \"980176938\",\n    \"784626857\",\n    \"77973950\",\n    \"951224867\",\n    \"358246424\",\n    \"136451422\",\n    \"371936240\",\n    \"651607899\",\n    \"806160386\",\n    \"515942917\",\n    \"390594722\",\n    \"17417160\",\n    \"5179894\",\n    \"554785078\",\n    \"882337958\",\n    \"299254647\",\n    \"15758000\",\n    \"965169285\",\n    \"825030283\",\n    \"501403228\",\n    \"220750034\",\n    \"784174655\",\n    \"979976656\",\n    \"20530480\",\n    \"751299482\",\n    \"417880003\",\n    \"712409910\",\n    \"465123203\",\n    \"197619154\",\n    \"416395816\",\n    \"305205122\",\n    \"442215433\",\n    \"374976337\",\n    \"648609649\",\n    \"973943578\",\n    \"66014534\",\n    \"501705216\",\n    \"118190038\",\n    \"47586814\",\n    \"581955590\",\n    \"755978297\"\n  ]\n}",
  "difficulty": "interview",
  "url": "https://codeforces.com/problemset/problem/1174/E",
  "starter_code": ""
}